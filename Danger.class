import org.powerbot.script.rt6.ClientContext;
import org.powerbot.script.rt6.GameObject;

/**
 * Created by Joseph18 on 12/5/2014.
 */
public class Danger extends Task<ClientContext> {
    private final String[] curMaxStrings = ctx.widgets.component(1430, 4).component(7).text().split("/");
    private int currentHealth;
    private int healthPercentage;

    public Danger(ClientContext ctx){
        super(ctx);
    }


    @Override
    public boolean activate() {
        currentHealth = (ctx.varpbits.varpbit(659) & 0xFFFF) >>> 1;
        healthPercentage = (currentHealth *100) / Integer.valueOf(curMaxStrings[1]);
        return healthPercentage < 18
                && ctx.players.local().inCombat();
    }

    @Override
    public void execute() {
        GameObject safeObject = ctx.objects.select().id(30849).nearest().poll();
        if (safeObject.inViewport()) {
            ctx.movement.step(safeObject);
            System.out.println("Now wait...");
            try{
                Thread.sleep(300);
            } catch (Exception e){
                System.out.println(e.toString());
            }
        } else {
            System.out.println("Moving to Object");
            ctx.camera.turnTo(safeObject);
            ctx.movement.step(safeObject);
        }

    }
}

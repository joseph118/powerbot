package Classes;

import org.powerbot.script.rt6.Action;
import javax.swing.JOptionPane;
import java.util.ArrayList;

/**
 * Created by Joseph18 on 12/6/2014.
 */
public class ClientContext extends org.powerbot.script.rt6.ClientContext{
    private String[] curMaxStrings = this.widgets.component(1430, 4).component(7).text().split("/");
    private Action[] actionList;

    public ClientContext(org.powerbot.script.rt6.ClientContext ctx){
        super(ctx);
    }

    public double getHealth(){
        double currentHealth = (this.combatBar.health() / (double) this.combatBar.maximumHealth()) * 100;
        if(currentHealth == 100){
            try {
                currentHealth = (this.varpbits.varpbit(659) & 0xFFFF) >>> 1;
                currentHealth = (currentHealth * 100) / Double.valueOf(curMaxStrings[1]);
            } catch (Exception e) {
                JOptionPane.showMessageDialog(null, "Please use the Correct Layout for Combat! Check Forum for more Detail!", "Interface Error", JOptionPane.ERROR_MESSAGE);
            }
        }
        return currentHealth;
    }

    public boolean checkUI(){
        try {
            double testHP;
            testHP = (this.varpbits.varpbit(659) & 0xFFFF) >>> 1;
            testHP = (testHP * 100) / Double.valueOf(curMaxStrings[1]);
            return true;
        } catch (Exception e) {
            JOptionPane.showMessageDialog(null, "Please use the Correct Layout for Combat! Check Forum for more Detail!", "Interface Error", JOptionPane.ERROR_MESSAGE);
        }
        return false;
    }

    public Action[] getActionBar(){
        return this.actionList;
    }

    public void setActionBar(){
        final Action[] actions = this.combatBar.actions();
        ArrayList<Action> temp = new ArrayList<Action>();
        for(Action act : actions){
            if(act.valid() == true){
                temp.add(act);
            }
        }
        actionList = temp.toArray(new Action[temp.size()]);
    }

    public void updateMaxHealth(){
        this.curMaxStrings = this.widgets.component(1430, 4).component(7).text().split("/");
    }


}

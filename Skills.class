import org.powerbot.script.rt6.ClientContext;

import java.util.Calendar;
import java.util.Random;

/**
 * Created by Joseph18 on 12/3/2014.
 */
public class Skills extends Task<ClientContext>{
    boolean isSkillOn;
    Calendar currentDate;
    Calendar timerDate;
    int maxKey = 0;

    public Skills(ClientContext ctx, boolean isSkillOn, int maxKey){
        super(ctx);
        this.maxKey = maxKey;
        this.isSkillOn = isSkillOn;

        if(isSkillOn == true){
            timerDate = Calendar.getInstance();
            incrementTimer();
        }
    }

    public Skills(ClientContext ctx, boolean isSkillOn) {
        super(ctx);
        this.isSkillOn = isSkillOn;

        if(isSkillOn == true){
            timerDate = Calendar.getInstance();
            incrementTimer();
        }
    }

    @Override
    public boolean activate() {
        currentDate = Calendar.getInstance();
        return ctx.players.local().inCombat()
                && !ctx.players.local().inMotion()
                && isSkillOn == true
                && checkTimer();
    }

    private boolean checkTimer(){
        if(isSkillOn == true){
            if(currentDate.after(timerDate)) return true;
        }
        return false;
    }

    @Override
    public void execute(){
        if(currentDate.after(timerDate)) {
            System.out.println("Pressed Skill Key");
            ctx.input.send(returnKey());
            incrementTimer();
        }
    }

    private String returnKey(){
        Random rn = new Random();
        int rand = rn.nextInt(1) + maxKey;
        return "{VK_" + rand + "}";
    }

    private void incrementTimer(){
        Random rn = new Random();
        int rand = rn.nextInt(1) + 8;
        timerDate.add(Calendar.SECOND, rand);
    }

}
